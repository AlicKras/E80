<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.521">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>E80 SP24 - Lab 0: Tutorial and Skills Review</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">E80 SP24</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../lectures/"> 
<span class="menu-text">Lectures</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs">    
        <li>
    <a class="dropdown-item" href="../../labs/lab_overview">
 <span class="dropdown-text">Lab Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab0">
 <span class="dropdown-text">Lab 0: Tutorial &amp; Skills Review</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab1">
 <span class="dropdown-text">Lab 1: Go Autonomous</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab2">
 <span class="dropdown-text">Lab 2: BEM</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab3">
 <span class="dropdown-text">Lab 3: Op-Amps</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab4">
 <span class="dropdown-text">Lab 4: Temperature</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab5">
 <span class="dropdown-text">Lab 5: Acoustics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab6">
 <span class="dropdown-text">Lab 6: Fluids</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab7">
 <span class="dropdown-text">Lab 7: Navigation</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../project/"> 
<span class="menu-text">Project</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../reference/"> 
<span class="menu-text">Reference Designs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../history/"> 
<span class="menu-text">History</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/HMC-E80/E80"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#frame-assembly" id="toc-frame-assembly" class="nav-link" data-scroll-target="#frame-assembly">Frame Assembly</a></li>
  <li><a href="#battery" id="toc-battery" class="nav-link" data-scroll-target="#battery">Battery</a></li>
  <li><a href="#breadboarding" id="toc-breadboarding" class="nav-link" data-scroll-target="#breadboarding">Breadboarding</a></li>
  <li><a href="#oscilloscope" id="toc-oscilloscope" class="nav-link" data-scroll-target="#oscilloscope">Oscilloscope</a></li>
  <li><a href="#soldering" id="toc-soldering" class="nav-link" data-scroll-target="#soldering">Soldering</a></li>
  <li><a href="#arduino" id="toc-arduino" class="nav-link" data-scroll-target="#arduino">Arduino</a></li>
  <li><a href="#github-desktop-setup" id="toc-github-desktop-setup" class="nav-link" data-scroll-target="#github-desktop-setup">Github Desktop Setup</a></li>
  <li><a href="#matlab-access" id="toc-matlab-access" class="nav-link" data-scroll-target="#matlab-access">Matlab Access</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 0: Tutorial and Skills Review</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Team size: 4</p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In the first week of E80, we have a regular lab scheduled, but there is no submission sheet. This is an opportunity for refreshing your skills and getting software and hardware setup for Labs 1 through 7.</p>
<p>By the end of this lab you should have:</p>
<ul class="task-list">
<li><label><input type="checkbox">Chosen and resized an E79 robot frame</label></li>
<li><label><input type="checkbox">Prepared 3 waterproof motors, tested them, and attached them to the frame</label></li>
<li><label><input type="checkbox">Charged your battery</label></li>
<li><label><input type="checkbox">Reviewed breadboarding and use of oscilloscope and power supply</label></li>
<li><label><input type="checkbox">Checked out and soldered header pins to Teensy 4.0 <strong>(Limited supply - Do not lose/break/eat)</strong></label></li>
<li><label><input type="checkbox">Set up the Arduino IDE on your computer</label></li>
<li><label><input type="checkbox">Set up Github Desktop on your computer</label></li>
<li><label><input type="checkbox">Downloaded E80 source code</label></li>
<li><label><input type="checkbox">Set up MATLAB</label></li>
</ul>
<p>Ask your instructor for any guidance including where to find tools. Don’t forget to clean up afterwards.</p>
<p>Although less critical for this introduction lab, <strong>it will be imperative to get into the habit of distributing work across team members.</strong> Identify dependencies and <strong>work in parallel.</strong> Smells like pre-lab work.</p>
</section>
<section id="frame-assembly" class="level2">
<h2 class="anchored" data-anchor-id="frame-assembly">Frame Assembly</h2>
<p>We will be reusing the frames from the ROV’s you constructed during E79 but some modifications will need to be made in order to change your ROV (Remotely Controlled Vehicle) into an AUV (Autonomous Underwater Vehicle).</p>
<p>To fit the waterproof box that will house the motherboard, microcontroller, battery, additional sensors, etc., you will need to increase the width of the frame.</p>
<p>Obtain two additional 6.5’’ PVC pieces to replace the 4.5’’ ones. Don’t forget to drill the mounting holes for your vertical motor.</p>
<p><img src="img/rov.png" class="img-fluid"></p>
<p>You will be mounting your AUV’s motors in the same manner as the three motor assembly in <a href="https://sites.google.com/g.hmc.edu/e79-practicum/module-1/practicum-1a">Practicum 1A Section 4.7</a>.</p>
<p>Each team will be provided with 2 used motors. You will need to construct at least one additional motor from scratch. Reference <a href="https://sites.google.com/g.hmc.edu/e79-practicum/module-1/practicum-1a">Practicum 1A Section 4.2</a> for assembly instructions.</p>
<p>Make sure to test that all three of your motors pull less than 500 mA before mounting them on the new frame. To do this, supply 6 V to the motor using a power supply.</p>
</section>
<section id="battery" class="level2">
<h2 class="anchored" data-anchor-id="battery">Battery</h2>
<p>Your AUV will need power, and we provide that with a battery pack. The battery pack used in E80 is a 3000 mAh to 3500 mAh, 30 C, 11.1 V LiPo battery pack. Determine the maximum, minimum and nominal voltage outputs of these battery packs. Determine how many cells are in the battery pack. To charge the batteries, we will use a <a href="https://hitecrcd.com//images/products/pdf/419_X1mini_Manual_BAS-V2-Web.pdf">HiTec x1 Mini charger</a> or a <a href="http://www.hrpdealer.com/pdf/manuals/UPTUP60AC%20Manual.pdf">UP60AC multi charger</a>. Read the manual on how to use the chargers.</p>
<p>Request a battery and a LiPo safe bag from an instructor and set up your battery for charging. ASK AN INSTRUCTOR OR PROCTOR TO CHECK YOUR RECHARGE SETUP. Here are some helpful <a href="https://drive.google.com/open?id=1K1DSOdeqAjU_JU-sTOdiBUnwMmpwUTPP">images</a>. Charge the battery up to its maximum voltage.</p>
<div class="note-box">
<p><strong>Note</strong>: Make sure you plug the balancer cable into the balance lead socket (the black wire should align with the minus sign). <strong>Failure to do this may cause the battery to explode!</strong> Always use a LiPo-safe bag while charging.</p>
</div>
</section>
<section id="breadboarding" class="level2">
<h2 class="anchored" data-anchor-id="breadboarding">Breadboarding</h2>
<p>A few videos that may help explain how a breadboard works and how to use one can be found below. Note that internal connections of breadboards can break.</p>
<ol type="1">
<li><p><a href="https://www.youtube.com/watch?v=wCJKMFGEuuI">Simple LED Lesson</a>: The tutorial shows an LED circuit without a current limiting resistor. LED’s resistance decreases quickly as the forward voltage (the ”on” voltage) is exceeded. The LED then draws more and more current, overheats and eventually burns up. Sometimes literally. Please use one.</p>
<p><span class="math display">\[R=\frac{(V_s-V_F)}{I_F}\]</span></p>
<p>where <span class="math inline">\(V_S\)</span> is the supply voltage, and <span class="math inline">\(V_F\)</span> and <span class="math inline">\(I_F\)</span> are the foward voltage and current of the diode respectively and can be found on LED datasheet found <a href="https://www.aopled.com/AOP_PDFs/L513SRD-C.pdf">here</a>.</p></li>
<li><p><a href="https://www.youtube.com/watch?v=S_a-qCy6Ekk" target="_blank">Breadboard Internals</a>.</p></li>
<li><p><a href="https://www.youtube.com/watch?v=Vbz_MKT7KnI" target="_blank">How to build a 555 Timer circuit</a>. Here is a <a href="https://www.elprocus.com/blinking-led-using-555-timer-ic/">link with a circuit diagram</a>. Here is a <a href="https://www.youtube.com/watch?time_continue=385&amp;v=i0SNb__dkYI&amp;feature=emb_logo" target="_blank">video on how the 555 works.</a></p></li>
</ol>
</section>
<section id="oscilloscope" class="level2">
<h2 class="anchored" data-anchor-id="oscilloscope">Oscilloscope</h2>
<p>You will be using an oscilloscope for most E80 labs. If you need a refresher on how to use an oscilloscope, refer to <a href="https://sites.google.com/g.hmc.edu/e79-practicum/module-2/practicum-2b">Practicum 2B</a> from E79.</p>
</section>
<section id="soldering" class="level2">
<h2 class="anchored" data-anchor-id="soldering">Soldering</h2>
<p>You will need to checkout a Teensy from an instructor and solder header pins in order to easily interact with microcontroller on board. For the first half of this course you will only need to interact with the pins on either side of the Teensy; however, you may need to add additional pins during the project phase.</p>
<p><strong>Teensys are in limited supply.</strong> Practice boards are available if you need a refresher.</p>
<p>A helpful video on how to solder can be found <a href="https://www.youtube.com/watch?v=Qps9woUGkvI" target="_blank">here</a>.</p>
<p>Remember to:</p>
<ol type="1">
<li>Never leave your soldering iron unattended.</li>
<li>Turn the iron off any time it isn’t used for more than 30 seconds. A good rule of thumb is “The iron is off unless you are holding it right now.”</li>
<li>Use recently soaked sponge. Use a spray bottle to moisten. Never use the sink or water fountain.</li>
<li>Use fume extractor: fumes from rosin in solder is a respiratory irritant.</li>
<li>Wash hands after handling solder – solder is 40% lead. Skin contact is harmless, but ingestion can occur with unwashed hands when eating, drinking, or smoking.</li>
<li>Always tin the tip of your iron before turning it off.</li>
</ol>
<p><img src="img/teensy.png" class="img-fluid"></p>
</section>
<section id="arduino" class="level2">
<h2 class="anchored" data-anchor-id="arduino">Arduino</h2>
<p>You should install Arduino on your own computer using the instructions in <a href="../../labs/lab1/#arduino-programming">Section 3 of Lab 1</a>. This kind of work, where you read a lab ahead of time and take preparatory actions that are in-keeping with the pre-lab policy on the home page, is called pre-lab work. Pre-lab work is extremely valuable, so setting up Arduino this way is a great first step into the course.</p>
<p>Run through a few more Arduino tutorials: You will need to solder pins to the Teensy.</p>
<ol type="1">
<li><p><a href="https://www.pjrc.com/teensy/tutorial.html">Blinking lights on the Arduino board</a>:</p></li>
<li><p><a href="https://www.pjrc.com/teensy/tutorial2.html">Hooking up an external LED</a></p></li>
</ol>
</section>
<section id="github-desktop-setup" class="level2">
<h2 class="anchored" data-anchor-id="github-desktop-setup">Github Desktop Setup</h2>
<p>Next you need to configure Git on your machine. Git is a distributed version control system. This means you can download a local clone of a collection of source code files and easily track the changes that you make to your code. While we won’t be using all the features of git in E80, we will introduce you to the main features that will enable you to interact with the code base for your robot.</p>
<p>Navigate to the Github page with the <a href="https://github.com/HMC-E80/E80-SP2023#git-setup">E80 codebase</a> and scroll down to the section titled “Git Setup.” You can also follow the direct link <a href="https://github.com/HMC-E80/E80-SP2023#git-setup">here</a>.</p>
<p>After completing these instructions you should have a folder on your computer with all the E80 starter source code for the semester and have the Arduino IDE set up to easily access and load the provided sketchbooks.</p>
</section>
<section id="matlab-access" class="level2">
<h2 class="anchored" data-anchor-id="matlab-access">Matlab Access</h2>
<p>You will be using Matlab to help analyze and interact with data throughout this course.</p>
<p>You will first need to <a href="https://www.mathworks.com/academia/tah-portal/harvey-mudd-college-30622674.html">Visit the Matlab Portal</a> and log in using your Mathworks account. If you do not have an account, create one using your <code>username@hmc.edu</code> credentials.</p>
<p>To acquire a local install of Matlab on your computer you can do the following:</p>
<ol type="1">
<li><a href="https://www.mathworks.com/academia/tah-portal/harvey-mudd-college-30622674.html">Visit the Matlab Portal</a>.</li>
<li>Choose to download the installer and select your operating system.</li>
<li>Run the installer and log into your Mathworks account again.</li>
<li>Select “Individual” license and complete the installation process.</li>
</ol>
<p>It is also possible to use an online copy of Matlab found <a href="https://mathematica.wolframcloud.com/">here</a>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>